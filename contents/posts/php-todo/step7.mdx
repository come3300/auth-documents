---
title: 第7回：TODOを編集できるようにしよう
category: php
---

## **🎯 今回の目標**

- TODOに「編集」ボタンを追加
- 編集画面（フォーム）を表示して既存の内容を変更可能に
- 内容と期限の両方を更新できるようにする

---

## **📁 フォルダ構成の追加**

```
todo-app/
├── todo/
│   ├── edit.php            ← ★ 編集フォームの表示＆更新処理
```

---

## **①todo/edit.phpの作成**

1つのファイルに「編集画面の表示」と「更新処理」をまとめています。

```php
<?php
require_once __DIR__ . '/../db/db.php';

$id = $_GET['id'] ?? null;
$method = $_SERVER['REQUEST_METHOD'];

if ($method === 'GET' && $id !== null) {
    // 編集フォーム表示
    $stmt = $pdo->prepare("SELECT * FROM todos WHERE id = :id");
    $stmt->execute(['id' => $id]);
    $todo = $stmt->fetch(PDO::FETCH_ASSOC);

    if (!$todo) {
        echo "TODOが見つかりませんでした。";
        exit;
    }
} elseif ($method === 'POST') {
    // フォーム送信（更新処理）
    $id = $_POST['id'] ?? null;
    $task = $_POST['task'] ?? '';
    $dueDate = $_POST['due_date'] ?? null;

    if ($id !== null && trim($task) !== '') {
        $stmt = $pdo->prepare("UPDATE todos SET task = :task, due_date = :due_date WHERE id = :id");
        $stmt->execute([
            'task' => $task,
            'due_date' => $dueDate !== '' ? $dueDate : null,
            'id' => $id
        ]);
    }

    header('Location: /');
    exit;
}
?>

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>TODO編集</title>
</head>
<body>
    <h1>TODO編集</h1>

    <form action="/edit" method="POST">
        <input type="hidden" name="id" value="<?= htmlspecialchars($todo['id']) ?>">
        <p>
            内容：<input type="text" name="task" value="<?= htmlspecialchars($todo['task']) ?>" required>
        </p>
        <p>
            期限：<input type="date" name="due_date" value="<?= htmlspecialchars($todo['due_date'] ?? '') ?>">
        </p>
        <button type="submit">更新</button>
        <a href="/">キャンセル</a>
    </form>
</body>
</html>
```

---

## **②views/todo.phpに「編集」ボタンを追加**

```php
<!-- 編集ボタン追加 -->
<form action="/edit" method="GET" style="display:inline;">
    <input type="hidden" name="id" value="<?= $todo['id'] ?>">
    <button type="submit">編集</button>
</form>
```

配置イメージ（削除や完了ボタンと並べて設置）：

```php
<li class="<?= $todo['is_completed'] ? 'completed' : '' ?>">
    <?= htmlspecialchars($todo['task'], ENT_QUOTES, 'UTF-8') ?>
    <?php if ($todo['due_date']): ?>
        <span class="due">（期限：<?= htmlspecialchars($todo['due_date']) ?>）</span>
    <?php endif; ?>

    <!-- 完了トグル -->
    <form action="/complete" method="POST" style="display:inline;">
        <input type="hidden" name="id" value="<?= $todo['id'] ?>">
        <button type="submit"><?= $todo['is_completed'] ? '未完了に戻す' : '完了' ?></button>
    </form>

    <!-- 編集ボタン -->
    <form action="/edit" method="GET" style="display:inline;">
        <input type="hidden" name="id" value="<?= $todo['id'] ?>">
        <button type="submit">編集</button>
    </form>

    <!-- 削除ボタン -->
    <form action="/delete" method="POST" style="display:inline;">
        <input type="hidden" name="id" value="<?= $todo['id'] ?>">
        <button type="submit">削除</button>
    </form>
</li>
```

---

## **✅ 動作確認手順**

1. ブラウザで http://localhost:8000 を開く
2. TODOの横にある「編集」ボタンをクリック
3. 内容や期日を変更し、「更新」ボタンで保存
4. 一覧画面に戻って、更新された内容が表示されていればOK！

---

## **🔚 今回のまとめ**

- TODOに編集ボタンを追加し、内容と期日の編集を可能にした
- 編集用のGET/POST処理を1つのファイルで構成
- より実用的なアプリへと一歩前進！

---

## **📌 次回予告**

次回は、「完了済み／未完了だけを絞り込んで表示できるフィルタ機能」を追加していきます！

使い勝手向上のための**表示切り替えUI**にも挑戦していきましょう 🔍