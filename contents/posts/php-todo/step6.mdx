---
title: 第6回：TODOに期限を設定しよう
category: php
---

## **🎯 今回の目標**

- TODOに「期限日（due_date）」を設定できるようにする
- HTMLフォームに日付入力フィールドを追加
- 期限付きで登録 → 表示時に期日も見えるようにする
- 期日で並び替えて表示できるようにする

---

## **📁 フォルダ構成の追加・変更（コード上は最小限）**

```
todo-app/
├── todo/
│   ├── add.php               ← ★ 期限をDBに保存するよう変更
├── views/
│   └── todo.php              ← ★ フォームと表示を期限対応に
```

---

## **① MySQLに期限カラムを追加**

既存の todos テーブルに due_date カラム（DATE 型）を追加：

```
ALTER TABLE todos ADD due_date DATE;
```

---

## **②todo/add.phpの修正（期限も登録）**

```
<?php
require_once __DIR__ . '/../db/db.php';

$task = $_POST['task'] ?? '';
$dueDate = $_POST['due_date'] ?? null;

if (trim($task) !== '') {
    $stmt = $pdo->prepare("INSERT INTO todos (task, due_date) VALUES (:task, :due_date)");
    $stmt->execute([
        'task' => $task,
        'due_date' => $dueDate !== '' ? $dueDate : null
    ]);
}

header('Location: /');
exit;
```

---

## **③todo/index.phpの取得を期日順に変更（OPTION）**

```
<?php
require_once __DIR__ . '/../db/db.php';

$stmt = $pdo->query("SELECT * FROM todos ORDER BY due_date IS NULL, due_date ASC, created_at DESC");
$todos = $stmt->fetchAll(PDO::FETCH_ASSOC);

require_once __DIR__ . '/../views/todo.php';
```

- due_date IS NULL で期日が設定されていないものを後ろに
- それ以外は日付順に並べます

---

## **④views/todo.php（フォームと表示に期日追加）**

```php
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>TODOアプリ</title>
    <style>
        .completed {
            text-decoration: line-through;
            color: gray;
        }
        .due {
            font-size: 0.9em;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>TODOリスト</h1>

    <!-- TODO追加フォーム -->
    <form action="/add" method="POST">
        <input type="text" name="task" placeholder="やることを入力" required>
        <input type="date" name="due_date">
        <button type="submit">追加</button>
    </form>

    <h2>やること一覧</h2>
    <ul>
        <?php foreach ($todos as $todo): ?>
            <li class="<?= $todo['is_completed'] ? 'completed' : '' ?>">
                <?= htmlspecialchars($todo['task'], ENT_QUOTES, 'UTF-8') ?>

                <?php if ($todo['due_date']): ?>
                    <span class="due">（期限：<?= htmlspecialchars($todo['due_date'], ENT_QUOTES, 'UTF-8') ?>）</span>
                <?php endif; ?>

                <!-- 完了トグル -->
                <form action="/complete" method="POST" style="display:inline;">
                    <input type="hidden" name="id" value="<?= $todo['id'] ?>">
                    <button type="submit">
                        <?= $todo['is_completed'] ? '未完了に戻す' : '完了' ?>
                    </button>
                </form>

                <!-- 削除 -->
                <form action="/delete" method="POST" style="display:inline;">
                    <input type="hidden" name="id" value="<?= $todo['id'] ?>">
                    <button type="submit">削除</button>
                </form>
            </li>
        <?php endforeach; ?>
    </ul>
</body>
</html>
```

---

## **✅ 動作確認手順**

1. ブラウザで http://localhost:8000 にアクセス
2. TODOを追加時に「期限」を指定
3. 一覧で、期日付きで表示されているか確認
4. 並び順が日付順（期日なしは最後）になっていればOK！

---

## **🔚 今回のまとめ**

- フォームに date 型入力を追加し、期日付きTODOを実装
- DBに due_date を保存し、表示にも反映
- 並び順も日付を考慮して改善

---

## **📌 次回予告**

次回は、「TODOの編集機能」を実装します。

登録済みのTODOの「内容」「期限」「完了状態」を更新できるようにして、アプリの使い勝手をさらに高めましょう ✍️