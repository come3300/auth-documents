---
title: 第8回：TODOを絞り込み表示できるようにしよう
category: php
---

## **🎯 今回の目標**

- 「すべて」「未完了」「完了済み」のフィルターボタンを追加
- 完了状態に応じて表示内容を切り替える処理を実装
- フィルター選択時も整ったURLでアクセスできるようにする

---

## **📁 フォルダ構成（変更なし）**

ファイルの追加はありません。既存の todo/index.php と views/todo.php に機能を追加します。

---

## **①todo/index.phpに絞り込み処理を追加**

```php
<?php
require_once __DIR__ . '/../db/db.php';

// クエリパラメータから絞り込み条件取得
$filter = $_GET['filter'] ?? 'all';

switch ($filter) {
    case 'completed':
        $stmt = $pdo->prepare("SELECT * FROM todos WHERE is_completed = 1 ORDER BY due_date IS NULL, due_date ASC");
        break;
    case 'active':
        $stmt = $pdo->prepare("SELECT * FROM todos WHERE is_completed = 0 ORDER BY due_date IS NULL, due_date ASC");
        break;
    default:
        $stmt = $pdo->prepare("SELECT * FROM todos ORDER BY due_date IS NULL, due_date ASC");
}

$stmt->execute();
$todos = $stmt->fetchAll(PDO::FETCH_ASSOC);

require_once __DIR__ . '/../views/todo.php';
```

---

## **②views/todo.phpにフィルターボタン追加**

HTML内に以下のフィルターリンクを追加します：

```php
<h2>やること一覧</h2>

<!-- フィルターリンク -->
<div>
    <a href="/?filter=all">すべて</a> |
    <a href="/?filter=active">未完了</a> |
    <a href="/?filter=completed">完了済み</a>
</div>
```

> ※「すべて」は初期状態、他は状態別に表示を切り替えます。
> 

---

## **✅ 表示例（HTML構造）**

```php
<h2>やること一覧</h2>

<!-- フィルターリンク -->
<div>
    <a href="/?filter=all">すべて</a> |
    <a href="/?filter=active">未完了</a> |
    <a href="/?filter=completed">完了済み</a>
</div>

<ul>
    <!-- ここにフィルター結果のTODOが並ぶ -->
</ul>
```

---

## **✅ 動作確認手順**

1. ブラウザで http://localhost:8000 にアクセス
2. TODOを複数追加し、いくつか完了状態にする
3. 「未完了」リンクをクリック → 完了していないTODOのみ表示される
4. 「完了済み」リンク → 完了済みのTODOだけ表示される
5. 「すべて」リンク → 全件表示に戻る

---

## **🔚 今回のまとめ**

- クエリパラメータで完了状態に応じた絞り込みを実装
- SQLの WHERE 条件を切り替えて表示内容をコントロール
- UIにリンク式フィルターを導入して使いやすさアップ！