---
title: 第5回：TODOに完了フラグを追加しよう
category: php
---

## **🎯 今回の目標**

- TODOに「完了フラグ（boolean）」を追加する
- 完了ボタンを実装し、クリックで状態を切り替える
- 完了済みのTODOは取り消し線などで視覚的に区別する

---

## **📁 フォルダ構成の追加・変更**

```
todo-app/
├── todo/
│   ├── complete.php        ← ★ 完了状態を切り替える処理（新規）
└── views/
    └── todo.php            ← 完了表示対応
```

---

## **① MySQLに完了フラグを追加**

まず、既存の todos テーブルに is_completed カラムを追加します。

```
ALTER TABLE todos ADD is_completed BOOLEAN NOT NULL DEFAULT FALSE;
```

---

## **②todo/complete.php（完了状態の切り替え）**

```
<?php
require_once __DIR__ . '/../db/db.php';

$id = $_POST['id'] ?? null;

if ($id !== null) {
    // 現在の状態を取得
    $stmt = $pdo->prepare("SELECT is_completed FROM todos WHERE id = :id");
    $stmt->execute(['id' => $id]);
    $todo = $stmt->fetch(PDO::FETCH_ASSOC);

    if ($todo) {
        $newStatus = $todo['is_completed'] ? 0 : 1;

        // 状態を反転して更新
        $stmt = $pdo->prepare("UPDATE todos SET is_completed = :status WHERE id = :id");
        $stmt->execute([
            'status' => $newStatus,
            'id' => $id
        ]);
    }
}

header('Location: /');
exit;
```

---

## **③views/todo.php（表示の変更＋完了ボタン追加）**

```
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>TODOアプリ</title>
    <style>
        .completed {
            text-decoration: line-through;
            color: gray;
        }
    </style>
</head>
<body>
    <h1>TODOリスト</h1>

    <form action="/add" method="POST">
        <input type="text" name="task" placeholder="やることを入力" required>
        <button type="submit">追加</button>
    </form>

    <h2>やること一覧</h2>
    <ul>
        <?php foreach ($todos as $todo): ?>
            <li class="<?= $todo['is_completed'] ? 'completed' : '' ?>">
                <?= htmlspecialchars($todo['task'], ENT_QUOTES, 'UTF-8') ?>

                <!-- 完了トグルボタン -->
                <form action="/complete" method="POST" style="display:inline;">
                    <input type="hidden" name="id" value="<?= $todo['id'] ?>">
                    <button type="submit">
                        <?= $todo['is_completed'] ? '未完了に戻す' : '完了' ?>
                    </button>
                </form>

                <!-- 削除ボタン -->
                <form action="/delete" method="POST" style="display:inline;">
                    <input type="hidden" name="id" value="<?= $todo['id'] ?>">
                    <button type="submit">削除</button>
                </form>
            </li>
        <?php endforeach; ?>
    </ul>
</body>
</html>
```

---

## **✅ 動作確認手順**

1. ブラウザで http://localhost:8000 にアクセス
2. TODOを追加
3. 「完了」ボタンをクリック → スタイルが変更される
4. 再度「未完了に戻す」をクリック → 通常表示に戻る
5. 表示がDBと同期していれば成功！

---

## **🔚 今回のまとめ**

- MySQLテーブルに is_completed フラグを追加
- 完了状態をトグルする処理を追加
- 完了済みTODOの表示に視覚的変化をつけた

---

## **📌 次回予告**

次回は、「TODOに期限を設定して、期限付きリストを表示する」機能に挑戦します！

日付入力とソートの仕組みも取り入れて、より実用的なアプリに仕上げていきましょう 📅