---
title: 第3回：TODOの削除機能を実装
category: php
---

## **🎯 今回の目標**

- 各TODOに「削除ボタン」を表示
- ボタンを押すと該当のTODOをセッションから削除
- モジュール構成に従ってファイルを追加

---

## **📁 追加・変更後のフォルダ構成**

```
todo-app/
├── public/
│   └── index.php              ← エントリポイント
├── todo/
│   ├── index.php              ← 一覧表示とビュー読み込み
│   ├── add.php                ← TODO追加処理
│   └── delete.php             ← TODO削除処理 ★新規追加
└── views/
    └── todo.php               ← HTMLビュー
```

---

## **①views/todo.php（削除ボタンの追加）**

```
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>TODOアプリ</title>
</head>
<body>
    <h1>TODOリスト</h1>

    <form action="/add" method="POST">
        <input type="text" name="task" placeholder="やることを入力" required>
        <button type="submit">追加</button>
    </form>

    <h2>やること一覧</h2>
    <ul>
        <?php foreach ($todos as $index => $todo): ?>
            <li>
                <?= htmlspecialchars($todo, ENT_QUOTES, 'UTF-8') ?>
                <form action="/delete" method="POST" style="display:inline;">
                    <input type="hidden" name="index" value="<?= $index ?>">
                    <button type="submit">削除</button>
                </form>
            </li>
        <?php endforeach; ?>
    </ul>
</body>
</html>
```

- foreach のループで $index => $todo に変更
- 削除フォームに該当インデックス番号を hidden フィールドで渡しています

---

## **②todo/delete.php（削除処理）**

```
<?php
session_start();

$index = $_POST['index'] ?? null;

// 指定インデックスが存在する場合のみ削除
if (isset($_SESSION['todos'][$index])) {
    unset($_SESSION['todos'][$index]);
    // 添え字の振り直し（連番維持のため）
    $_SESSION['todos'] = array_values($_SESSION['todos']);
}

header('Location: /');
exit;
```

- unset() で要素を削除したあと、array_values() でインデックスを振り直しています
- 削除後は一覧ページにリダイレクト

---

## **✅ 動作確認手順**

1. ブラウザで http://localhost:8000 を開く
2. 何件かTODOを追加する
3. 各項目に表示された「削除」ボタンをクリック
4. 該当のTODOだけが削除されていれば成功！

---

## **🛠 補足・改善案**

- 確認ダイアログをJavaScriptで表示することで誤削除防止（発展課題）
- 完了済みにする機能も似た構造で追加できます

---

## **📌 次回予告**

次回は、「TODOの保存先をMySQLに変更」して、セッションではなく**データベースに保存・取得**できるようにします。

DockerのMySQLコンテナを使って、簡単なDB連携に挑戦しましょう！