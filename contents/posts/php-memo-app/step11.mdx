---
title: 第１１回：ログイン状態に応じたアクセス制限
category: php
---

このパートでは、**ログイン状態に応じてアクセスできるページを制限する**機能を実装します。

---

## 🎯 目標

ログイン状態によって、以下のように遷移させるようにします：

### 🔓 ログインしていない場合：

| アクセス先 | 表示内容 |
| --- | --- |
| `/memo/` | 🔁 `/login/` にリダイレクト |
| `/login/` | ログイン画面 |
| `/user/` | ユーザー登録画面 |
| `/`（ルート） | 🔁 `/login/` にリダイレクト |

---

### 🔐 ログインしている場合：

| アクセス先 | 表示内容 |
| --- | --- |
| `/memo/` | メモ投稿画面 |
| `/login/` | 🔁 `/memo/` にリダイレクト |
| `/user/` | 🔁 `/memo/` にリダイレクト |
| `/`（ルート） | 🔁 `/memo/` にリダイレクト |

---

## 🛠️ 実装手順

---

### 1. `index.php`（ルート）の作成

`index.php` をプロジェクトのルートに追加します。

📄 `index.php`

```php
<?php
    header('Location: ./login/');
    exit;

```

🔍 **解説**：

- 常にログイン画面へリダイレクトします（ログイン判定は `/login/index.php` 側で行います）。
- `exit` を入れることで、後続の処理を止めます。

---

### 2. ログイン画面 `/login/index.php` にアクセス制御を追加

📄 `login/index.php`

```php
<?php
    session_start();

    // 🔽 追加する部分
    require '../common/auth.php';

    if (isLogin()) {
        header('Location: ../memo/');
        exit;
    }
?>

```

---

### 3. ユーザー登録画面 `/user/index.php` にアクセス制御を追加

📄 `user/index.php`

```php
<?php
    session_start();

    // 🔽 追加する部分
    require '../common/auth.php';

    if (isLogin()) {
        header('Location: ../memo/');
        exit;
    }
?>

```

---

### 4. メモ投稿画面 `/memo/index.php` にアクセス制御を追加

📄 `memo/index.php`

```php
<?php
    require '../common/auth.php';

    if (!isLogin()) {
        header('Location: ../login/');
        exit;
    }
?>
<!DOCTYPE html>
<html lang="ja">

```

🔍 **解説**：

- 否定演算子 `!isLogin()` により「未ログインの場合のみ」ログイン画面へリダイレクトします。

---

## ✅ 動作確認

### ログインしていないとき：

| アクセスパス | 表示される画面 |
| --- | --- |
| `/` | 🔁 `/login/` にリダイレクト |
| `/memo/` | 🔁 `/login/` にリダイレクト |
| `/login/` | ログイン画面表示 |
| `/user/` | ユーザー登録画面 |

---

### ログインしているとき（セッションに `$_SESSION['user']` が存在する）：

| アクセスパス | 表示される画面 |
| --- | --- |
| `/` | 🔁 `/memo/` にリダイレクト |
| `/login/` | 🔁 `/memo/` にリダイレクト |
| `/user/` | 🔁 `/memo/` にリダイレクト |
| `/memo/` | メモ投稿画面表示 |

---

## 🎉 まとめ

これで、ユーザーがログインしているかどうかに応じて、表示する画面を切り替えることができました！

次は、ログアウト機能の実装を行うことで、ログイン状態を自由に制御できるようになります。